#  **SDU-Forum 实现思路**



# 一、用户模块

## 一、 用户注册与登录

### 注册流程

1.前端输入：

​	1.用户提供学号和密码
​	2.学号作为唯一标识符

2.后端处理：

​	1.检查学号是否已存在
​	2.生成随机盐值(salt)
​	3.使用PBKDF2算法对密码进行哈希处理（包含盐值和迭代次数）
​	4.存储用户凭证到数据库

用户表结构：

| 字段名        | 类型     | 描述               |
| ------------- | -------- | ------------------ |
| id            | 自增主键 | 用户唯一ID         |
| user_id       | 字符串   | 学号（唯一标识符） |
| hash_password | 字符串   | 哈希后的密码       |
| salt          | 字符串   | 加密盐值           |
| iterations    | 整数     | 哈希迭代次数       |

### 登录流程

1.验证用户凭证

​	1.前端输入：

​		1.用户提供学号和密码

​	2.后端验证：

​		1.查询数据库获取该学号的记录

​		2.使用存储的盐值和迭代次数对输入的密码进行相同的哈希处理

​		3.比较生成的哈希值与存储的哈希值是否匹配

2.实现持久化登录

​	1.Token生成与返回

​	后端在用户成功登录后返回两个Token

| Token类型     | 用途          | 有效期 |
| ------------- | ------------- | ------ |
| Access Token  | 用于API鉴权   | 15分钟 |
| Refresh Token | 用于刷新Token | 7天    |

​	2.前端Token管理

​		1.Token由前端保存到本地

​		2.创建请求拦截器来对Token进行验证和刷新

​	3.后端Token刷新机制

​		1.前端携带Refresh Token进行请求

​		2.后端验证 Refresh Token 是否在黑名单或过期

​		3.无效则需重新登录，有效则生成新的Access Token并返回

## 二、用户封禁与解封

### 封禁

1.操作方式：

​	1.由管理员在后台管理系统操作

2.封禁处理：

​	1.被封禁的用户账号会被加入到账号黑名单表中

​	2.设置封禁期限（分为有限期和无限期）

3.封禁效果：

​	1.封禁期间不能登录

​	2.到期后自动从黑名单中删除

4.验证机制

​	1.登录时先检查用户是否在黑名单中

### 解封

1.自动解封：

​	1.封禁到期后自动从黑名单中删除

 2.手动解封

​	2.由管理员在后台管理系统提前将账号从黑名单中删除

黑名单表结构

| 字段名    | 类型     | 描述         |
| --------- | -------- | ------------ |
| id        | 自增主键 | 记录ID       |
| user_id   | 字符串   | 被封禁的账号 |
| ban_start | 时间戳   | 封禁开始时间 |
| ban_end   | 时间戳   | 封禁结束时间 |
| reason    | 字符串   | 封禁原因     |

## 三、用户资料

### 编辑用户资料

1.可编辑字段：

​	1.头像

​	2.昵称

​	3.个人背景图

​	4.其他个人信息

2.后端处理：

​	1.验证用户身份

​	2.对上传的图片文件进行格式校验和大小限制

​	3.存储用户资料变更到数据库

用户资料表结构

| 字段名              | 类型     | 描述                 |
| ------------------- | -------- | -------------------- |
| id                  | 自增主键 | 记录ID               |
| account_id          | 整数     | 关联的用户唯一ID     |
| nickName            | 字符串   | 昵称                 |
| avatar_url          | 字符串   | 头像路径             |
| background_url      | 字符串   | 背景图路径           |
| bio                 | 字符串   | 个人简介             |
| created_at          | 时间戳   | 账号创建时间         |
| liked_count         | 整数     | 所有贴子收到的点赞数 |
| favorite_post_count | 整数     | 喜欢的贴子数         |
| publishd_post_count | 整数     | 以发布的贴子数       |

### 返回用户详细信息

1.接口设计：

​	1.获取当前用户资料

​	2.获取指定用户资料

2.权限控制

 	1.本人可查看完整信息

​	2.其他用户只能查看公开信息

​	3.管理员可查看所有用户完整信息



# 二、贴子模块

##  一、贴子分类与展示

- 贴子分类

	| 分类id | 分类名称 | 描述               |
	| ------ | -------- | ------------------ |
	| 1      | 二手闲置 | 校园二手物品交易   |
	| 2      | 打听求助 | 校园生活问题咨询   |
	| 3      | 社团活动 | 社团招新和活动发布 |
	| 4      | 校园招聘 | 实习和就业信息     |
	| 5      | 学习搭子 | 学习伙伴招募       |

- 前端展示

	1.采用5个tab页切换不同分类

	2.每个tab页按时间倒序展示贴子列表

	3.贴子卡片显示：

	​	1.作者信息（头像+昵称）

	​	2.发布时间

	​	3.标签列表

	​	4.点赞数和评论数

	​	5.缩略内容

- 贴子表结构

	| 字段名         | 类型   | 描述           |
	| -------------- | ------ | -------------- |
	| id             | 整数   | 贴子唯一ID     |
	| author_id      | 整数   | 关联用户唯一ID |
	| content        | 文本   | 贴子文本内容   |
	| favorite_count | 整数   | 点赞数         |
	| comment_count  | 整数   | 评论数         |
	| created_at     | 时间戳 | 贴子创建时间   |

- 贴子图片表

	| 字段名       | 类型   | 描述                             |
	| ------------ | ------ | -------------------------------- |
	| id           | 整数   | 记录ID                           |
	| post_id      | 整数   | 关联贴子唯一ID                   |
	| image_url    | 字符串 | 图片路径                         |
	| upload_order | 整数   | 图片上传顺序（用于还原展示顺序） |

## 二、标签系统

1.标签表结构

| 字段名 | 类型     | 描述       |
| ------ | -------- | ---------- |
| id     | 自增主键 | 标签唯一ID |
| name   | 字符串   | 标签名称   |

2.贴子-标签关联表

| 字段名  | 类型 | 描述   |
| ------- | ---- | ------ |
| post_id | 整数 | 贴子ID |
| tag_id  | 整数 | 标签ID |

3.功能特点：

​	1.系统预制常用标签

​	2.发帖时可选择已有标签或创建新标签

表关系图![表关系图](C:/Users/35245/AppData/Roaming/Typora/typora-user-images/image-20250710173444864.png)

# 三、搜索模块

## 一、搜索功能设计

- 搜索方式

	1.全文搜索：

	​	1.对帖子内容建立全文索引

	​	2.支持模糊匹配和关键词高亮

	2.标签搜索：

	​	1.按标签精确匹配相关贴子

	​	2.支持多标签组合筛选

- 搜索接口

	1.全文搜索接口：

	​	1.按相关度返回匹配的贴子列表

​	2.标签搜索接口：

​		1.按时间倒序返回匹配的贴子列表

## 二、热门贴子展示

1.默认展示规则：

​	1.搜索框下展示top10热门贴子

​	2.排序算法：点赞数×0.6 + 评论数×0.4

​	3.每小时更新缓存

2.热门贴子接口：

​	1.按排序结果顺序返回热门贴子列表



# 四、评论模块

## 一、评论数据结构

1.comment类设计

```
class Comment {
public:
    // 构造函数
    Comment(int id, int post_id);  // 通过ID和帖子ID构造
    Comment(int post_id, const std::string& nickName, int father, 
            const std::string& to_nickName, const std::string& text); // 创建新评论
    Comment(int post_id);  // 通过帖子ID构造
    
    // 数据库操作
    bool createTable();    // 创建评论表
    bool saveComment();    // 保存评论到数据库
    
    // 获取评论
    Json getFirstComment();     // 获取一级评论
    Json getChildrenComment(int father); // 获取子评论
    
    // 点赞功能
    int like();    // 点赞
    int unlike();  // 取消点赞

private:
    int post_id;        // 关联的帖子ID
    int father;         // 父评论ID (0表示一级评论)
    int id;             // 评论唯一ID
    std::string tableName;  // 评论表名
    std::string to_nickName; // 回复目标用户昵称
    std::string nickName;    // 评论者昵称
    std::string text;        // 评论内容
};
```

2.评论表结构

| 字段名      | 类型   | 描述         |
| ----------- | ------ | ------------ |
| id          | 整数   | 评论ID       |
| post_id     | 整数   | 关联贴子ID   |
| father      | 整数   | 父评论ID     |
| nickName    | 字符串 | 评论者昵称   |
| to_nickName | 字符串 | 回复目标昵称 |
| text        | 文本   | 评论内容     |
| created_at  | 时间戳 | 创建时间     |
| like_count  | 整数   | 点赞数       |

## 二、评论功能实现

1.发布评论

​	1.前端提交：

​		1.贴子id(post_id)

​		2.评论内容（text）

​		3.父评论id(father,可选)

​		4.回复目标昵称（to_nickName可选）

​	2.后端处理：

​		1.验证用户身份

​		2.创建Comment对象

​		3.调用saveComment()保存到数据库

​		4.返回操作结果

2.获取评论

​	1.分级获取：

​		1.先获取一级评论（father=0)

​		2.递归获取子评论（father=父评论id）

3.点赞功能

​	1.点赞操作：

​		1.调用like()增加点赞数
​		2.返回当前点赞数

​	2.取消点赞：

​		1.调用unlike()减少点赞数
​		2.返回当前点赞数

4.前端交互设计

​	1.评论展示：

​		1.树形结构展示评论层级
​		2.支持展开/折叠子评论
​		3.显示点赞数和用户昵称

​	2.交互功能：

​		1.回复按钮：展开回复表单
​		2.点赞按钮：切换点赞状态
​		3.分页加载：滚动加载更多评论

# 五、后台管理系统

## 1.用户管理模块

#### 用户列表

​	1.功能：
​		1.分页展示所有注册用户
​		2.支持按学号/昵称搜索
​		3.查看用户详细信息
​		4.封禁/解封操作

#### 封禁管理

​	1.功能：

​		1.封禁记录查询
​		2.手动解封操作
​		3.封禁原因统计图表

#### 用户反馈信息

​	1.功能:
​		1.查看用户反馈信息

## 2.内容管理模块

#### 帖子管理

​	1.功能:
​		1.按分类查看帖子
​		2.帖子内容审核
​		3.违规帖子删除
​		4.帖子搜索

#### 评论管理

​	1功能:
​		1.评论内容审核
​		2.违规评论删除
​		3.评论树形展示

#### 标签管理

​	1功能:
​		1.系统标签维护
​		2.标签使用统计
​		3.热门标签分析

## 3.系统监控模块

#### 运行状态

​	1.功能:
​		1.服务器资源监控
​		2.API请求统计
​		3.异常请求报警

#### 日志管理

​	1功能:
​		1.操作日志记录
​		2.异常日志查询
​		3.日志导出
